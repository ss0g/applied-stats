---
title: "Analysis of the Various Factors Influencing the Success of FRC Teams"
author: "Troy Edwards"
date: "2023--06--16"
output:
    pdf_document:
        number_sections: True
header_includes:
    \usepackage{amsmath}
    \allowdisplaybreaks
fontsize: 12pt
documentclass: article
geometry:
    margin=1in
---

```{r setup, include=F}
setwd("C:\\Users\\tntje\\work\\school\\applied-stats\\s2\\final")

library(tidyverse)
library(ggplot2)
library(pivottabler)

dotenv::load_dot_env()

frc_events_api_token <- Sys.getenv()["FRC_TOKEN"]
tba_api_token <- Sys.getenv()["TBA_TOKEN"]

sample_size <- 30

waahs_2022 <- read.csv("./Auburn Scouting 2022 - Data.csv") # auburn
pncmp_2022 <- read.csv("./Public Copy of Cheney District Scouting 4915 2022 - Data.csv") # districts

wasno_2023 <- read.csv("./Copy of 4915 Scouting 2023 - Glacier Peak State - Data.csv") # glacier peak
waahs_2023 <- read.csv("./Copy of 4915 Scouting 2023 - April 4, 7 33 PM - Auburn Data.csv") # auburn
pncmp_2023 <- read.csv("./Copy of 4915 Scouting 2023 - April 12, 1 20 PM - Data.csv") # districts
```

\tableofcontents

\begin{abstract}
\textbf{TODO}
\end{abstract}

\section{Introduction}

FIRST Robotics Competition is a robotics competition in which teams of high schoolers build robots to compete in a game
that is different every year. FIRST is the organization that runs these competitions, and the acronym FIRST stands for
"For the Inspiration and Recognition of Science and Technology." Each year, FIRST reveals a new game in which alliances
of 3 industrial-size robots compete against each other on a field to complete various tasks. Teams have limited time
after "Kickoff" (the game reveal) to design, build, wire, and program their robot to perform the tasks required for the
game. For example, in this year's game, CHARGED UP, robots must travel across the field to the Substation Area to pick
up one game piece (a cube or a cone) at a time and then travel back to their alliance's Grid and deposit the pieces
onto Nodes. 

There are many factors that could have an effect on a team's success. These include general things about the team, such
as the team's age, its budget, and its size, and also things about their robot in a specific season, such as drivetrain
type and scoring capability. The goal of this research is to determine which of these factors have the greatest effect
on a team's success. 

<!-- TODO -->
\textbf{TODO: ADD MORE CONTENT HERE} 

\section{Method}

\subsection{Analysis of individual variables}

I plan to analyze whether several variables have a significant influence on a team's success. \textbf{TODO: ADD MORE HERE (HOW IS SUCCESS MEASURED?)}
<!-- TODO -->

\subsubsection{Drivetrain}

A robot's drivetrain can have a huge influence on how successful it is. FRC games are typically quite fast-paced, so a
better drivetrain can make a huge difference. For most games, the playing field is quite flat, with few obstacles to
overcome. This is true of both RAPID REACT and CHARGED UP. In games with few obstacles, teams will typically use some
sort of "normal" drivetrain (i.e. one without huge wheels or anything like that). The three main types of drivetrain
typically found in FRC are:
\begin{enumerate}
    \item Differential
    \item Mecanum
    \item Swerve
\end{enumerate}
A differential drive has normal wheels on the left and right sides of the robot. A Mecanum drive uses Mecanum wheels,
which are special wheels with diagonal rollers mounted around the circumference. A robot with a mecanum drivetrain can
drive forwards and backwards, similar to a differential drivetrain, but it can also drive sideways by driving specific
wheels in specific directions. A swerve drive is another type of drivetrain that can drive in any direction, but unlike
the Mecanum drivetrain, the swerve drive achieves this by using two motors for each wheel: one to drive the wheel, and
another to steer the wheel. This allows each wheel to be steered independently of the others, which allows for complex
maneuvers.

<!-- TODO: maybe a picture of a mecanum wheel and/or a swerve module here? -->

These can be grouped into two categories, namely holonomic (Mecanum and swerve) and non-holonomic (differential). The
difference between these two categories is that while a non-holonomic drivetrain constrains a robot to only move
forwards and backwards such that it must turn to change its direction of motion, a holonomic drivetrain is free of
these constraints. 

A differential drive is usually the cheapest, since it requires no special parts. The next cheapest of these three is
the Mecanum drive because you only need the 4 wheels and a motor for each. However, one major drawback of a Mecanum
drivetrain is that the wheels are more prone to slipping. This means that a robot with a Mecanum drivetrain has a lower
maximum acceleration before the wheels start to slip. It also means that in FRC, a robot with a Mecanum drivetrain is
very easy to play defense against because a robot with a differential drive or a swerve drive can easily shove it
it around. Finally, the most expensive, but also the most effective is the swerve drive. The swerve drive combines the
lack of slip (and by extension, pushing power) of a differential drivetrain with the flexibility of a holonomic
drivetrain. The main drawback of swerve drive is that it can at times be prohibitively expensive, with a single swerve
module typically costing upwards of $300 not even including the motors. This is because they are very complex, with
lots of gears and custom machined parts. 

To analyze the effect of drivetrain on a team's success, I will perform two inference tests: 
\begin{enumerate}
    \item A two sample difference of means $t$-test to compare the success of teams using holonomic and non-holonomic
    drivetrains
    \item A one-way ANOVA test to see if the difference in success is any greater if Mecanum and Swerve are not grouped
    together
\end{enumerate}

\subsubsection{Scoring capability}

A robot's scoring capability can have a very direct effect on its success. If a robot can only score in locations that
give low amounts of points, such as the LOWER HUB in RAPID REACT or the HYBRID NODES in CHARGED UP. Robots that are
able to score in locations that give higher amounts of points are obviously going to score more points than robots that
can't in almost every situation. From what I've seen, robots built by "good" teams tend to have this capability. 

Also, in CHARGED UP, some teams can only score cubes or cones. Many teams can do both, but teams that can only do one
could potentially be at a disadvantage. 

In the event of a specific robot being a chassis bot (i.e. only a drivetrain, can't score any pieces), the scoring
capability will be NA.

To analyze the effect of scoring capability I will do a different set of inference tests for RAPID REACT and for
CHARGED UP:
\begin{enumerate}
    \item For RAPID REACT, I will do a 2-sample difference of means $t$-test to compare robots that score low against
    robots that score high.
    \item For CHARGED UP, I will do a one-way ANOVA test to see if there is a difference in the success of robots that
    can only score in the HYBRID NODES, robots that can score in the MIDDLE NODES, and robots that can score in the
    HIGH NODES. I will also do a 2-sample difference of means $t$-test to compare the success of robots that can only
    score one type of game piece against that of those that can score both types. 
\end{enumerate}
<!-- TODO: possibly reformat above? -->

\subsubsection{Consistency}

A common characteristic of robots that people would consider "good" is consistency. These robots tend to perform very
consistently throughout an event and throughout the season, with the main source of inconsistency being an improvement
in the skill of the driver. This will only be analyzed for the Pacific Northwest because the scouting data is the only
data source detailing the performance of individual robots.

To analyze the effect of consistency on a robot's success, I will calculate the standard deviation of the change in
score between consecutive matches for all of a robot's matches. Then, I will create a linear model using that standard
deviation to predict win rate and perform a $t$-test for slope to see if the relationship is significant. 

<!-- TODO: need to add more robot-related factors here for the RAPID REACT and CHARGED UP sections -->

\subsubsection{Team budget}

It is easy to see why a team's budget can affect its success. A higher budget can allow for a more complex robot with
more expensive features such as a swerve drive.
<!-- TODO: add more content here -->

To analyze the effect of budget on a robot's success, I will create a model using budget to predict win rate and
perform a $t$-test for slope to see if the relationship is significant. 

\subsubsection{Team size}

A team's size can also have a huge effect on its success. A larger team means that more work can get done, which means
that the robot can be more complex and advanced. This will likely be correlated with some of the other variables, so it
may not be included in the final model to avoid multicollinearity. 
<!-- TODO: decide if this will be in final model -->

To analyze the effect of a team's size on its success, I will create a model using team size to predict win rate and
perform a $t$-test for slope to see if the relationship is significant. 

\subsubsection{Team age}
An older team will likely have more advanced techniques and manufacturing processes at its disposal, while a younger
team will typically not have these things. Team number is a good proxy to team age because the team numbers are
assigned sequentially. This variable will also likely be correlated with many of the other variables, so it may not be
included in the final model.
<!-- TODO: decide if this will be in final model -->

To analyze the effect of a team's age on its success, I will create a model using team age to predict win rate and
perform a $t$-test for slope to see if the relationship is significant.

\subsection{Predictive models}

After analyzing individual variables, I will create two models:
\begin{enumerate}
    \item A multiple linear regression model using a combination of the above variables to predict a team's overall win
    rate
    \item A multiple logistic regression model using a combination of the above variables and various metrics from a
    robot's allies and opponents to predict whether a robot will win a specific match
\end{enumerate}

\subsection{Data collection and sources}

My data comes from three main sources:
\begin{enumerate}
    \item Evan Kuykendall's 2023 scouting data from Glacier Peak, Auburn, and the Pacific Northwest District
    Championship
    \item Jake Benjamin's 2022 scouting data from Auburn and the Pacific Northwest District Championship
    \item The Blue Alliance
\end{enumerate}

The scouting datasets contain information about each robot in every match that was scouted. An example of something
that would be included in the data for 2022 would be number of pieces scored in the UPPER HUB while an example of
something that would be included in the data for 2023 would be number of pieces scored in HYBRID NODES. The Blue
Alliance only has more general data, such as match results (win/loss). However, it also contains information about who
was on what alliance for a specific match. This will be useful for gathering data about alliance members to use in the
logistic regression model. 

```{r sampling, include=F}
union3 <- \(x, y, z) union(x, union(y, z))

all_teams_2022 <- na.omit(union(
    unique(waahs_2022$Team.Number..ex..4915.),
    unique(pncmp_2022$Team.Number..ex..4915.)
))

all_teams_2023 <- na.omit(union3(
    unique(wasno_2023$Team.Number.you.re.scouting),
    unique(waahs_2023$Team.Number.you.re.scouting),
    unique(pncmp_2023$Team.Number.you.re.scouting)
))

select_sample_2022 <- function() {
    set.seed(3)
    teams <- sample(all_teams_2022, sample_size)
    return(teams)
}

select_sample_2023 <- function() {
    set.seed(13)
    teams <- sample(all_teams_2023, sample_size)
    return(teams)
}

teams_2022 <- select_sample_2022()
teams_2023 <- select_sample_2023()

print(teams_2022)
print(teams_2023)
```

```{r organization, include=F}
waahs_2022$event <- "waahs"
pncmp_2022$event <- "pncmp"

wasno_2023$event <- "wasno"
waahs_2023$event <- "waahs"
pncmp_2023$event <- "pncmp"

all_data_2022_raw <- bind_rows(waahs_2022, pncmp_2022)
all_data_2023_raw <- bind_rows(wasno_2023, waahs_2023, pncmp_2023)

all_data_2022_raw <- all_data_2022_raw %>% replace(is.na(.), 0)
all_data_2023_raw <- all_data_2023_raw %>% replace(is.na(.), 0)

all_data_2022_raw <- all_data_2022_raw[all_data_2022_raw$Match.. > 0,]
all_data_2023_raw <- all_data_2023_raw[all_data_2023_raw$Match.. > 0,]

rownames(all_data_2022_raw) <- NULL
rownames(all_data_2023_raw) <- NULL

yn_to_tf <- \(x) switch(x, "Yes" = T, "No" = F, NULL)
replace_if_null <- \(x, replace_with) ifelse(is.null(x), replace_with, x)

endgame_points_2022 <- \(climb_level) switch(climb_level, 4, 6, 10, 15) %>% replace_if_null(0)
endgame_points_2023 <- \(endgame_status) switch(endgame_status, "Not Parked" = 0, "Parked" = 2, "Docked" = 6, "Engaged" = 10) %>% replace_if_null(0) # nolint

auto_cs_points_2023 <- \(end_of_auto_status) switch(end_of_auto_status, "Not Docked" = 0, "Docked" = 8, "Engaged" = 12) %>% replace_if_null(0) # nolint

all_data_2022 <- data.frame(
    team_number = all_data_2022_raw$Team.Number..ex..4915.,
    match_number = all_data_2022_raw$Match..,
    taxied = ifelse(all_data_2022_raw$Did.it.taxi..move.in.auto.. == "Yes", T, F),
    auto_low_goals = all_data_2022_raw$X..of.Low.Goals.Scored,
    auto_high_goals = all_data_2022_raw$X..of.High.Goals.Scored,
    teleop_low_goals = all_data_2022_raw$X..of.Low.Goals.Scored.2,
    teleop_high_goals = all_data_2022_raw$X..of.High.Goals.Scored.2,
    climbed = all_data_2022_raw$Did.the.Robot.Climb.,
    climb_level = all_data_2022_raw$Climb.Level,
    total_auto_points = (
        all_data_2022_raw$X..of.Low.Goals.Scored * 2 +
        all_data_2022_raw$X..of.High.Goals.Scored * 4 +
        ifelse(all_data_2022_raw$Did.it.taxi..move.in.auto.. == "Yes", 2, 0)
    ),
    total_teleop_points = (
        all_data_2022_raw$X..of.Low.Goals.Scored.2 +
        all_data_2022_raw$X..of.High.Goals.Scored.2 * 2
    ),
    total_endgame_points = unlist(lapply(all_data_2022_raw$Climb.Level, endgame_points_2022))
)

all_data_2023 <- data.frame(
    team_number = all_data_2023_raw$Team.Number.you.re.scouting,
    match_number = all_data_2023_raw$Match..,
    mobility = ifelse(all_data_2023_raw$Mobility. == "Yes", T, F),
    end_of_auto_status = all_data_2023_raw$End.of.Auto.Status,
    auto_hybrid_cubes = all_data_2023_raw$Bottom.Cubes,
    auto_mid_cubes = all_data_2023_raw$Middle.Cubes,
    auto_high_cubes = all_data_2023_raw$Top.Cubes,
    auto_hybrid_cones = all_data_2023_raw$Bottom.Cones,
    auto_mid_cones = all_data_2023_raw$Middle.Cones,
    auto_high_cones = all_data_2023_raw$Top.Cones,
    teleop_hybrid_cubes = all_data_2023_raw$Bottom.Cubes.2,
    teleop_mid_cubes = all_data_2023_raw$Middle.Cubes.2,
    teleop_high_cubes = all_data_2023_raw$Top.Cubes.2,
    teleop_hybrid_cones = all_data_2023_raw$Bottom.Cones.2,
    teleop_mid_cones = all_data_2023_raw$Middle.Cones.2,
    teleop_high_cones = all_data_2023_raw$Top.Cones.2,
    endgame_status = all_data_2023_raw$Endgame.Status,
    total_auto_points = (
        ifelse(all_data_2023_raw$Mobility. == "Yes", 3, 0) +
        all_data_2023_raw$Bottom.Cubes * 3 +
        all_data_2023_raw$Middle.Cubes * 4 +
        all_data_2023_raw$Top.Cubes * 6 +
        all_data_2023_raw$Bottom.Cones * 3 +
        all_data_2023_raw$Middle.Cones * 4 +
        all_data_2023_raw$Top.Cones * 6 +
        unlist(lapply(all_data_2023_raw$End.of.Auto.Status, auto_cs_points_2023))
    ),
    total_teleop_points = (
        all_data_2023_raw$Bottom.Cubes.2 * 2 +
        all_data_2023_raw$Middle.Cubes.2 * 3 +
        all_data_2023_raw$Top.Cubes.2 * 5 +
        all_data_2023_raw$Bottom.Cones.2 * 2 +
        all_data_2023_raw$Middle.Cones.2 * 3 +
        all_data_2023_raw$Top.Cones.2 * 5
    ),
    total_endgame_points = unlist(lapply(all_data_2023_raw$Endgame.Status, endgame_points_2023))
)

all_data_2022 <- all_data_2022[all_data_2022$match_number > 0,]
all_data_2023 <- all_data_2023[all_data_2023$match_number > 0,]

rownames(all_data_2022) <- NULL
rownames(all_data_2023) <- NULL

write.csv(all_data_2022, "all_data_2022.csv")
write.csv(all_data_2023, "all_data_2023.csv")

get_team_data <- function(team_number, year) {
    if (year == 2022) {
        result <- all_data_2022[all_data_2022$team_number == team_number,]
        rownames(result) <- NULL
        return(result)
    } else if (year == 2023) {
        result <- all_data_2023[all_data_2023$team_number == team_number,]
        rownames(result) <- NULL
        return(result)
    }
}
```

\section{Findings}

\section{Analysis}

\section{Conclusion}

\section{Bibliography}